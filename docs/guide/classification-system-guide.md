# 資料分類與標記系統使用指南

## 系統概述

資料分類與標記系統是 RAG Store 的核心功能，提供智能文件分類、標籤管理和元資料提取，專為家庭資料管理設計。

## 功能特色

### 🎯 智能文件分類
- **自動分類**: 使用 OpenAI GPT 模型智能識別文件類型
- **預設分類**: 帳單、收據、成績單、健康記錄、保險文件等 9 大類別
- **分類信心度**: 提供 0-100% 的分類信心度評分
- **階層分類**: 支援父子關係的分類架構

### 🏷️ 標籤管理系統
- **自動標籤**: 根據文件內容自動建議相關標籤
- **手動標籤**: 支援用戶自定義標籤
- **標籤統計**: 顯示標籤使用頻率和文件數量
- **標籤篩選**: 支援多標籤組合查詢

### 📊 結構化資料提取
- **金額提取**: 自動識別並提取金額資訊
- **日期提取**: 支援多種日期格式（西元年、民國年）
- **人名識別**: 提取文件中的姓名資訊
- **公司識別**: 識別機構或公司名稱
- **關鍵字提取**: 自動提取重要關鍵詞

### 👨‍👩‍👧‍👦 家庭成員管理
- **成員設定**: 建立家庭成員檔案
- **文件歸屬**: 將文件關聯到特定家庭成員
- **權限控制**: 預留未來權限管理功能

## 使用流程

### 1. 系統初始化

首先設置資料庫架構：

```bash
# 設置分類系統資料庫
python setup_classification.py
```

### 2. 文件上傳與自動分類

1. **上傳文件**: 使用拖放或點擊上傳
2. **OCR 處理**: 自動提取文字內容
3. **智能分類**: AI 分析文件類型和內容
4. **資料提取**: 提取金額、日期等結構化資訊
5. **標籤建議**: 自動建議相關標籤
6. **元資料儲存**: 將分析結果儲存到資料庫

### 3. 分類管理介面

訪問 `/classification` 頁面使用以下功能：

#### 📈 統計資訊
- 各分類文件數量統計
- 熱門標籤使用排行
- 分類信心度分佈

#### 🔍 進階搜尋
- **分類篩選**: 選擇特定文件類型
- **標籤組合**: 多標籤交集查詢
- **日期範圍**: 指定時間區間
- **金額範圍**: 設定金額條件

#### 📋 文件列表
- 文件基本資訊展示
- 分類結果和信心度
- 關聯標籤顯示
- 提取的結構化資料

## API 端點

### 分類相關

```http
GET /api/categories
# 取得所有分類及文件數量統計

GET /api/tags  
# 取得所有標籤及使用統計

GET /api/documents?category=帳單&tags=重要&date_from=2025-01-01
# 根據條件查詢文件

GET /api/statistics
# 取得完整統計資訊
```

### 上傳處理

```http
POST /api/upload
# 上傳文件，自動執行分類和資料提取
# 回傳包含分類結果和提取資料的完整資訊
```

## 資料庫架構

### 核心表格

- `categories`: 文件分類定義
- `tags`: 標籤管理
- `documents`: 文件元資料
- `family_members`: 家庭成員資訊
- `document_tags`: 文件標籤關聯
- `embeddings`: 向量資料（新增 document_id 關聯）

### 關係設計

```sql
documents -> categories (多對一)
documents -> family_members (多對一)  
documents <-> tags (多對多)
embeddings -> documents (多對一)
```

## 分類規則

### 自動分類邏輯

系統使用以下特徵進行文件分類：

1. **帳單**: 包含「帳單」、「應繳」、「電費」、「水費」等關鍵字
2. **收據**: 包含「收據」、「發票」、商店名稱、商品明細
3. **成績單**: 包含「成績」、「分數」、「GPA」、學校名稱
4. **健康記錄**: 包含醫院名稱、檢查項目、數值指標
5. **保險文件**: 包含「保險」、「理賠」、「保單」
6. **稅務文件**: 包含「稅」、「報稅」、「扣繳」
7. **合約文件**: 包含「合約」、「契約」、「協議」
8. **證書證照**: 包含「證書」、「證照」、「資格」

### 標籤建議邏輯

- **重要**: 大金額、法律文件、重要日期
- **緊急**: 繳費期限接近、醫療急件
- **定期**: 每月帳單、定期檢查
- **年度**: 年終文件、年度總結
- **醫療**: 健康相關文件
- **教育**: 學習成長相關
- **財務**: 金錢相關交易
- **法律**: 合約證照類

## 最佳實務

### 上傳建議

1. **文件品質**: 確保文件清晰，避免模糊或扭曲
2. **檔案格式**: 優先使用 PDF，次選高解析度圖片
3. **命名規範**: 使用有意義的檔案名稱
4. **批量處理**: 同類型文件建議批量上傳

### 分類優化

1. **信心度監控**: 關注低信心度文件，手動校正
2. **標籤一致性**: 建立標準標籤體系，避免重複
3. **定期檢查**: 定期檢視分類結果，調整規則
4. **用戶回饋**: 收集使用者意見，持續改進

### 查詢技巧

1. **組合條件**: 善用多重篩選條件提升查詢精度
2. **時間範圍**: 合理設定日期範圍避免結果過多
3. **標籤策略**: 建立標籤分類體系，如重要性、時效性
4. **關鍵字搜尋**: 結合語義搜尋和結構化查詢

## 故障排除

### 常見問題

1. **分類錯誤**: 檢查 OpenAI API 配置，確認模型可用
2. **資料庫連線**: 驗證 TiDB Cloud 連線參數
3. **OCR 失敗**: 確認文件格式支援，檢查檔案完整性
4. **標籤重複**: 檢查標籤建立邏輯，避免大小寫差異

### 效能優化

1. **資料庫索引**: 確保關鍵欄位已建立索引
2. **API 快取**: 實作查詢結果快取機制
3. **批量處理**: 大量文件建議使用批量上傳
4. **定期清理**: 清理無效資料和重複記錄

## 未來擴展

### 計畫功能

1. **進階分析**: 支出趨勢分析、健康數據追蹤
2. **自動化工作流**: 特定條件觸發自動處理
3. **報表生成**: 自定義統計報表和視覺化圖表
4. **AI 助手**: 智能問答和數據洞察
5. **多語言支援**: 支援其他語言的文件處理

### 整合可能

1. **郵件系統**: 自動擷取電子郵件附件
2. **銀行 API**: 直接匯入交易記錄
3. **雲端儲存**: 支援 Google Drive、Dropbox 同步
4. **行動應用**: 開發手機 App 支援拍照上傳

---

*此文件隨系統更新持續維護，如有問題請參考 `/docs` 目錄下的其他文件或聯繫技術支援。*
