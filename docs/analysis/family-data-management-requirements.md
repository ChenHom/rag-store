# 家庭資料管理 RAG 系統需求分析

**文件建立日期：** 2025-07-12  
**分析範圍：** 基於現有 RAG Store 系統，評估家庭資料管理與問答功能的完善性  
**目標使用情境：** 家庭帳單、收據、成績單、健康記錄等文件的智能管理與問答  

## 專案概述

### 現有系統架構
- **後端：** FastAPI + Python
- **前端：** Next.js + TypeScript + Tailwind CSS
- **資料庫：** TiDB Cloud（向量搜尋）
- **AI 服務：** OpenAI text-embedding-3-small, GPT-3.5-turbo
- **處理能力：** 支援 PDF、圖檔、文字檔的 OCR 處理

### 目標使用情境
系統需要支援以下家庭資料管理場景：
- 📄 **帳單管理：** 水電費、電話費、信用卡帳單
- 🧾 **收據管理：** 購物收據、醫療收據、教育支出
- 📊 **成績單：** 學校成績、考試結果、學習進度
- 🏥 **健康記錄：** 身高體重、健康檢查報告、疫苗記錄
- 📧 **郵件文件：** 電子帳單、通知信件
- 🖼️ **圖片文件：** 手寫記錄、拍照文件

## 現有功能評估

### ✅ 已完成功能
1. **文件上傳系統**
   - 支援多種格式（PDF、圖檔、文字檔）
   - 拖放上傳介面
   - 檔案驗證機制

2. **OCR 文字提取**
   - 使用 unstructured 和 pytesseract
   - 支援中英文識別
   - 自動處理多種格式

3. **向量化與儲存**
   - OpenAI text-embedding-3-small 模型
   - TiDB Cloud 向量資料庫
   - 文字分塊處理（512 tokens, 50 overlap）

4. **RAG 查詢系統**
   - 語義搜尋
   - GPT-3.5-turbo 問答生成
   - 上下文相關回覆

5. **Web 介面**
   - 現代化 React 介面
   - 聊天問答頁面
   - 文件上傳頁面

## 🔴 關鍵缺失功能分析

### 1. 郵件處理模組
**現況：** 無法處理 email 格式的帳單、收據  
**影響：** 大量家庭帳單通過郵件傳遞，無法自動化處理  
**需求：**
- 郵件連接器（IMAP/POP3）
- 附件自動下載與分類
- 郵件內容解析
- 寄件者識別與分類

### 2. 資料分類與標記系統
**現況：** 所有文件混合儲存，無法分類管理  
**影響：** 查詢效率低，無法針對特定類型資料進行分析  
**需求：**
- 智能文件分類（帳單、收據、成績單、健康記錄）
- 標籤系統（家庭成員、類別、重要性）
- 日期自動識別與標準化
- 家庭成員自動標識

### 3. 結構化資料提取
**現況：** 只能進行文字提取，無法識別關鍵資訊  
**影響：** 無法進行數據分析、趨勢追蹤  
**需求：**
- 金額數據提取（支出、收入、餘額）
- 日期資訊標準化
- 身高體重等數值提取
- 成績數據結構化
- 醫療指標提取

### 4. 時間序列追蹤
**現況：** 無法追蹤數據變化趨勢  
**影響：** 無法監控家庭財務、健康狀況變化  
**需求：**
- 體重身高成長曲線
- 支出趨勢分析
- 健康數據變化監控
- 學習成績進步追蹤

### 5. 多維度搜尋與過濾
**現況：** 只支援語義搜尋  
**影響：** 無法精確定位特定條件的資料  
**需求：**
- 時間範圍搜尋
- 家庭成員過濾
- 資料類型分類
- 金額範圍查詢
- 複合條件搜尋

## 🟡 重要改進功能

### 6. 資料驗證與品質控制
**需求：**
- OCR 結果準確性驗證
- 重複文件檢測與合併
- 資料完整性檢查
- 異常數據標識

### 7. 批量處理與自動化
**需求：**
- 批量檔案上傳處理
- 定期郵件自動匯入
- 資料備份與同步
- 排程任務管理

### 8. 隱私與安全
**需求：**
- 敏感資料加密儲存
- 訪問權限控制
- 資料遮罩處理
- 審計日誌記錄

### 9. 報表與統計
**需求：**
- 家庭支出分析報表
- 健康數據視覺化圖表
- 財務狀況概覽
- 自定義報表生成

### 10. 進階問答功能
**需求：**
- 跨時間範圍查詢
- 跨類別比較分析
- 趨勢預測問答
- 複雜統計查詢

## 實作優先順序建議

### 📅 第一階段（核心功能）- 4-6 週
**目標：** 建立基本的家庭資料分類與管理能力

1. **資料分類與標記系統**
   - 實作文件類型自動識別
   - 建立標籤管理系統
   - 日期標準化處理

2. **結構化資料提取**
   - 金額數據提取模組
   - 關鍵資訊識別
   - 數據驗證機制

3. **多維度搜尋介面**
   - 進階搜尋頁面
   - 篩選條件組合
   - 搜尋結果優化

### 📅 第二階段（增強功能）- 6-8 週
**目標：** 提升系統智能化程度與使用體驗

1. **郵件處理模組**
   - 郵件連接器開發
   - 附件自動處理
   - 郵件分類規則

2. **時間序列追蹤**
   - 數據變化監控
   - 趨勢分析功能
   - 警報機制

3. **資料驗證與品質控制**
   - 準確性驗證
   - 重複檢測
   - 品質評分

### 📅 第三階段（進階功能）- 4-6 週
**目標：** 完善系統功能與使用者體驗

1. **報表與統計**
   - 視覺化圖表
   - 自定義報表
   - 數據導出

2. **批量處理與自動化**
   - 批量上傳優化
   - 自動化工作流程
   - 排程任務

3. **進階問答功能**
   - 複雜查詢支援
   - 智能建議
   - 對話式分析

## 系統架構變更

### 🔄 **部署架構更新**
基於您的需求，系統已從 ngrok 外部存取改為內網部署：

**變更前：**
```
互聯網 -> ngrok -> 前端 (port 3000) / 後端 (port 8000)
```

**變更後：**
```
內網用戶 -> nginx (port 80) -> 前端 (port 3000) / 後端 (port 8000)
```

**優勢：**
- ✅ 提升安全性，避免外部攻擊
- ✅ 降低延遲，提升回應速度
- ✅ 簡化部署流程，移除 ngrok 依賴
- ✅ 更好的資源控制與監控

## 技術架構建議

### 後端擴展需求
- **新增依賴套件：**
  - `pandas` - 數據分析
  - `matplotlib/plotly` - 圖表生成
  - `imaplib` - 郵件處理
  - `schedule` - 任務排程
  - `regex` - 進階文字處理

### 資料庫擴展需求
- **新增資料表：**
  - `documents` - 文件元資料
  - `categories` - 分類管理
  - `tags` - 標籤系統
  - `extracted_data` - 結構化資料
  - `family_members` - 家庭成員

### 前端擴展需求
- **新增頁面：**
  - 進階搜尋頁面
  - 資料分析儀表板
  - 分類管理頁面
  - 設定頁面

## 風險與挑戰

### 技術挑戰
1. **OCR 準確性：** 中文文件識別準確性有待提升
2. **資料提取複雜性：** 不同格式文件的結構化提取難度高
3. **效能考量：** 大量文件處理的效能優化

### 使用者體驗挑戰
1. **學習曲線：** 複雜功能可能增加使用難度
2. **資料隱私：** 敏感家庭資料的安全性考量
3. **維護成本：** 自動化規則的維護與調整

## 成功指標

### 功能指標
- [ ] 支援 5 種以上文件類型自動分類
- [ ] 關鍵資訊提取準確率 > 90%
- [ ] 查詢響應時間 < 2 秒
- [ ] 支援 10 種以上進階搜尋條件

### 使用者指標
- [ ] 文件處理成功率 > 95%
- [ ] 使用者滿意度 > 4.5/5
- [ ] 日常查詢問題解決率 > 85%

## 結論

現有的 RAG Store 系統已經具備了良好的基礎架構，包括文件上傳、OCR 處理、向量化儲存和基本問答功能。要達成家庭資料管理的目標，最關鍵的是要加強**資料分類與標記**、**結構化資料提取**和**多維度搜尋**這三個核心功能。

建議採用分階段實作的策略，優先實現核心功能，再逐步增加進階功能，確保系統的穩定性和使用者體驗。

---

**文件維護：** 此文件應隨著系統開發進度定期更新  
**相關文件：** 
- [RAG Store 系統架構文件](../setup/)
- [API 文件](../api/)
- [前端開發指引](../frontend/)
